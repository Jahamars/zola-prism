{% extends "index.html" %}
{% block body %}
<div class="wrap">
    <header>
        <a href="#" id="home-link" onclick="goBack(event)">
            <span id="back-icon">←</span>
            <span id="back-text">{{ config.extra.home | default(value="Back") }}</span>
        </a>
    </header>
    
    {% block content %}
    <div id="content">
        {% block title_block %}
        <div id="title">
            {% block title %}{% endblock title %}
        </div>
        {% endblock title_block %}
        
        {% block sections %}{% endblock sections %}
    </div>
    {% endblock content %}
    
    {% if config.extra.sam_bottom_menu %}
    <div class="bottom-menu">
        <p>
            {% if config.extra.sam_menu %}
                {% for link in config.extra.sam_menu %}
                    <a href="{{ link.link }}">{{ link.text }}</a>
                {% endfor %}
            {% endif %}
        </p>
    </div>
    {% endif %}
    
    <!-- Scroll to top button -->
    <button id="scroll-to-top" aria-label="Scroll to top">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="18 15 12 9 6 15"></polyline>
        </svg>
    </button>
    
    <footer>
        <div class="sam-footer">
            {% if config.extra.sam_footer %}
            {{ config.extra.sam_footer.text | safe }}
            {% endif %}
        </div>
    </footer>
</div>

<script>
// Smart Back/Home navigation
function goBack(event) {
    event.preventDefault();
    
    const currentPath = window.location.pathname;
    const baseUrl = "{{ config.base_url }}";
    const basePath = baseUrl.replace(/https?:\/\//, '').split('/').slice(1).join('/');
    
    // Определяем является ли текущая страница главной
    const isHomePage = currentPath === '/' || 
                       currentPath === `/${basePath}/` || 
                       currentPath === `/${basePath}` ||
                       currentPath === '/index.html';
    
    // Если на главной - ничего не делаем
    if (isHomePage) {
        return;
    }
    
    // Проверяем есть ли история и пришли ли мы с этого же сайта
    const hasHistory = window.history.length > 1;
    const cameFromSameSite = document.referrer && document.referrer.includes(window.location.host);
    
    // Если есть история И пришли с этого же сайта - идем назад
    if (hasHistory && cameFromSameSite) {
        window.history.back();
    } else {
        // Иначе идем на главную
        window.location.href = baseUrl;
    }
}

// Обновляем текст и иконку кнопки в зависимости от страницы
(function() {
    const currentPath = window.location.pathname;
    const baseUrl = "{{ config.base_url }}";
    const basePath = baseUrl.replace(/https?:\/\//, '').split('/').slice(1).join('/');
    
    const isHomePage = currentPath === '/' || 
                       currentPath === `/${basePath}/` || 
                       currentPath === `/${basePath}` ||
                       currentPath === '/index.html';
    
    const backIcon = document.getElementById('back-icon');
    const backText = document.getElementById('back-text');
    const homeLink = document.getElementById('home-link');
    
    if (isHomePage) {
        // На главной показываем Home и делаем неактивной
        if (backIcon) backIcon.textContent = '⌂';
        if (backText) backText.textContent = 'Home';
        if (homeLink) {
            homeLink.style.opacity = '0.5';
            homeLink.style.cursor = 'default';
        }
    } else {
        // На других страницах показываем стрелку и Back
        const hasHistory = window.history.length > 1;
        const cameFromSameSite = document.referrer && document.referrer.includes(window.location.host);
        
        if (hasHistory && cameFromSameSite) {
            if (backIcon) backIcon.textContent = '←';
            if (backText) backText.textContent = '{{ config.extra.home | default(value="Back") }}';
        } else {
            if (backIcon) backIcon.textContent = '⌂';
            if (backText) backText.textContent = 'Home';
        }
    }
})();

// Scroll to top functionality
(function() {
    const scrollToTopBtn = document.getElementById('scroll-to-top');
    
    if (!scrollToTopBtn) return;
    
    // Show/hide button based on scroll position
    function toggleScrollButton() {
        if (window.pageYOffset > 300) {
            scrollToTopBtn.classList.add('visible');
        } else {
            scrollToTopBtn.classList.remove('visible');
        }
    }
    
    // Smooth scroll to top
    function scrollToTop() {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    }
    
    // Event listeners
    window.addEventListener('scroll', toggleScrollButton);
    scrollToTopBtn.addEventListener('click', scrollToTop);
    
    // Initial check
    toggleScrollButton();
})();
</script>
{% endblock body %}
